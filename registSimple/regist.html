<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>注册 - Deskry 在线匿名聊天交友社区</title>
    <meta name="keywords" content="匿名聊,匿名聊天,虚拟恋人,倾诉,闲聊,叔叔有约,在线聊天,文爱,免费,交友,无需注册,匿名,隐私保护,deskry,无注册匿名在线聊天," />
    <meta name="Description" content="nmchat.cn（匿名聊）,这里可能是全球人气最火爆、功能最强大的匿名聊天社区,自动一对一匹配、建房群聊、私聊皆可,无需注册即可匿名畅聊交友,隐私无忧,畅所欲言！" />
    <script src="/js/min/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/js/min/layer/layer.js"></script>
    <link rel="stylesheet" href="/layuidemo/css/layui.css" media="all">
    <link rel="stylesheet" href="/regist/css/regist.css?v14" />
    <link rel="stylesheet" href="/random/css/csshake-slow.css?v14" />

	<style type="text/css">
	
        .layui-form-item .layui-input-inline {
            left: -25px;
        }

    </style>

    <script type="text/javascript">


    </script>

</head>
<body style="max-width: 640px; margin: 10px auto; border: 0px solid red; background-color: white;">
    <div class="groupMain">



        <div class="con_img">
            注 册
            <br />
            <!--<img src="/index/img/gg.jpg" style="width:100px;cursor:pointer;" />-->
        </div>

        <form class="layui-form" action="" style="width:300px;margin:0px auto;padding:0px;">

            <div class="layui-form-item" style="margin-bottom:0px;">
                <div class="layui-inline">
                    <label class="layui-form-label">用户名：</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nameMy" lay-verify="nameMy" autocomplete="off" class="layui-input" placeholder="请输入您的用户名【必填】">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-bottom:0px;">
                <div class="layui-inline">
                    <label class="layui-form-label">密码：</label>
                    <div class="layui-input-inline">
                        <input type="password" id="pwdMy" name="pwdMy" required lay-verify="pwdMy" placeholder="请输入密码【必填】" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-bottom:0px;">
                <div class="layui-inline">
                    <label class="layui-form-label">确认密码：</label>
                    <div class="layui-input-inline">
                        <input type="password" id="rpwdMy" name="rpwdMy" required lay-verify="rpwdMy" placeholder="请确认密码【必填】" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-bottom:0px;">
                <div class="layui-inline">
                    <label class="layui-form-label" style="font-size:10px;">绑定身份码：</label>
                    <div class="layui-input-inline">
                        <input id="userID" name="userID" required lay-verify="userID" placeholder="请确认身份码【必填】" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div style="text-align:center;">
                    <button class="layui-btn" lay-submit="" lay-filter="submitReg" style="width:95px;height:38px;">注册</button>
                    <button id="btn_reset" type="reset" class="layui-btn layui-btn-primary" style="width:95px;height:38px;">重置</button>
                </div>
            </div>

        </form>

        <div class="remark">
            温馨提示：欢迎注册 Deskry 匿名聊天。
        </div>

        <div class="con_title shake-slow shake-constant" style="display: none;">
            <img src="/img/sys/logo.png" />
        </div>

    </div>

    <script src="/layuidemo/layui.js" charset="utf-8"></script>

    <script>

        //验证两次密码是否一致
        //$('#rpwd').blur(function () {

        //});

        var index_loading;

        $(".con_img img").click(function () {

            layer.alert('<img src="/gg/img/gg3.jpg" style="width:200px;height:295px;margin-left:10px;" /><br/><div style="width:200px;margin:5px auto;text-align: center;color: #AAA;">长按保存图片 用微信扫一扫</div>', { title: '' })

        });


        function getQueryString(name) {
            var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        }

        var url_userID = getQueryString("userID");
		var url_servername = getQueryString("servername");

        $("#userID").val(url_userID);

        layui.use(['form'], function () {
            var form = layui.form

            //自定义验证规则
            form.verify({
                nameMy: function (value) {
                    if (value.length < 1) {
                        return '用户名不能为空';
                    }
                },
                pwdMy: function (value) {
                    if (value.length < 1) {
                        return '密码不能为空';
                    }
                },
                rpwdMy: function (value) {
                    if (value.length < 1) {
                        return '确认密码不能为空';
                    }
                },
                userID: function (value) {
                    if (value.length < 1) {
                        return '页面身份码不能为空';
                    }
                }

            });

            //监听提交
            form.on('submit(submitReg)', function (data) {

                var registinfo = $.parseJSON(JSON.stringify(data.field));

                if (registinfo.pwdMy != registinfo.rpwdMy) {
                    layer.msg('两次输入密码不一致!');
                    return false;
                };

                if ($("#userID").val().length != 32) {
                    layer.msg('绑定的身份码不合规');
                    return false;
                }

                index_loading = layer.load(2, {
                    shade: [0.3, '#000'], //0.1透明度的白色背景
                    time: 0
                });

                $.ajax(
                {
                    type: 'post',
                    url: '/asmx/method.asmx/regist',
                    async: true,
                    dataType: "json",
                    cache: false,
                    timeout: 5000,
                    data:
                    {
                        nameMy: encodeURI(registinfo.nameMy),
                        pwdMy: encodeURI(registinfo.pwdMy),
                        userID: encodeURI(registinfo.userID),
						servername: url_servername
                    },
                    success: function (data) {

                        if (data.state == 'True') {

                            //layer.alert(data.msg, {
                            //    title: ''
                            //})

                            $("#btn_reset").trigger("click");
                            layer.close(index_loading);

                            layer.msg('注册成功');

                            setTimeout(function () { parent.result_regist(data) }, 1500);

                        }
                        else {
                            layer.alert(data.msg, {
                                closeBtn: 0, //不显示关闭按钮
                                title: '',
                                shadeClose: true, //开启遮罩关闭
                            })
                        }


                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        if (textStatus == "timeout") {
                            console.info("延迟" + errorThrown);
                            layer.alert('网络故障，请重试', {
                                title: ''
                            })
                        }
                    },
                    complete: function () {
                        layer.close(index_loading);
                        return false;
                    }

                })


                return false;

            });


        });
    </script>

    <script type="text/javascript">

        $("#btn_say").click(function () {

            layer.alert('保存二维码后通过微信扫描相册二维码关注公众号', { icon: 5, title: '上传结果' });

        });


    </script>



</body>
</html>
